<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vzoom.zxxt.mapper.CreditDataMapper">

	<delete id="delete_zx_refetch_data" parameterType="java.util.Map">
      delete from zx_refetch_data where nsrsbh=#{NSRSBH,jdbcType=VARCHAR}  and sign='ZX_HENAN'
    </delete>

    <update id="update_zx_refetch_data_remark1" parameterType="java.util.Map">
      update zx_refetch_data set remark1 = #{remark1,jdbcType=VARCHAR} where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </update>

    <insert id="insert_hn_sqnsr_refetch" parameterType="java.util.HashMap">
		insert into hn_sqnsr_refetch(nsrsbh,dksqid,flag)
		       values(#{nsrsbh,jdbcType=VARCHAR},#{dksqid,jdbcType=VARCHAR},'0')
	</insert>

    <update id="update_hn_sqnsr_refetch" parameterType="String">
		update hn_sqnsr_refetch set flag='1',gxsj=sysdate where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
	</update>

    <!-- 获取 尚未取数的 信息-->
    <select id="select_hn_sqnsr_refetch" resultType="java.util.HashMap">
		select * from hn_sqnsr_refetch where flag='0' order by lrsj ASC
	</select>

    <select id="query_exist_hn_sqnsr_refetch" parameterType="string" resultType="string">
		select count(1) from hn_sqnsr_refetch where nsrsbh = #{nsrsbh,jdbcType=VARCHAR}
	</select>

    <select id="select_hn_sqnsr_refetch_1" parameterType="string" resultType="java.util.HashMap">
		select * from hn_sqnsr_refetch where flag='1' and nsrsbh = #{nsrsbh,jdbcType=VARCHAR}
	</select>

    <select id="query_hen_dj_ssxx" resultType="java.util.HashMap">
        select NSRSBH,NSRMC,FDDBRMC,FRYDDHHM,FRZJHM from HEN_DJ_SSXX
        WHERE nsrsbh = #{nsrsbh,jdbcType=VARCHAR}
        and frzjhm = #{fddbrsfzjhm,jdbcType=VARCHAR}
    </select>

    <select id="queryTimingTaskLock" resultType="int">
        select timing_task_lock_henan.nextval from dual
    </select>

    <insert id="insert_zx_refetch_data" parameterType="java.util.HashMap">
        insert into zx_refetch_data(
			id,
			nsrsbh,
			qymc,
			frzjhm,
			remark,
			remark1,
			flag,
			createtime,
			sign)
		values(
		#{ID,jdbcType=VARCHAR},
		#{NSRSBH,jdbcType=VARCHAR},
		#{NSRMC,jdbcType=VARCHAR},
		#{FRZJHM,jdbcType=VARCHAR},
		#{REMARK,jdbcType=VARCHAR},
		#{REMARK1,jdbcType=VARCHAR},
		'1',
		sysdate,
		'ZX_HENAN'
		)
    </insert>

    <insert id="insert_feedback_henan" parameterType="java.util.Map" >
    insert into FEEDBACK_HENAN (ID, DKSQID, NSRSBH,
      NSRMC, MD5, TRANID, DKPC, SPRQ,
      SPJG, DKSPXX, SXED,
      SXQX, XHBZ, QYLX, BLDKBZ,
      FFDKJE, FFDKSJ, DKYE,
      DKLV, DKQX, DKQXLX,
      DKEDLX, DHKJE, HKRQ, HKJE,
      AQHKBZ, KHYH, ZHXZ,
      ZHZH, KHSJ, BGSJ, BGNR,
      ZXSJ, RTNCODE, RTNMSG)
    values (#{id,jdbcType=VARCHAR}, #{dksqid,jdbcType=VARCHAR}, #{nsrsbh,jdbcType=VARCHAR},
      #{nsrmc,jdbcType=VARCHAR}, #{md5,jdbcType=VARCHAR}, #{tranid,jdbcType=VARCHAR}, #{dkpc,jdbcType=VARCHAR}, #{sprq,jdbcType=VARCHAR},
      #{spjg,jdbcType=VARCHAR}, #{dkspxx,jdbcType=VARCHAR}, #{sxed,jdbcType=VARCHAR},
      #{sxqx,jdbcType=VARCHAR}, #{xhbz,jdbcType=VARCHAR}, #{qylx,jdbcType=VARCHAR}, #{bldkbz,jdbcType=VARCHAR},
      #{ffdkje,jdbcType=VARCHAR}, #{ffdksj,jdbcType=VARCHAR}, #{dkye,jdbcType=VARCHAR},
      #{dklv,jdbcType=VARCHAR}, #{dkqx,jdbcType=VARCHAR}, #{dkqxlx,jdbcType=VARCHAR},
      #{dkedlx,jdbcType=CHAR}, #{dhkje,jdbcType=VARCHAR}, #{hkrq,jdbcType=VARCHAR}, #{hkje,jdbcType=VARCHAR},
      #{aqhkbz,jdbcType=VARCHAR}, #{khyh,jdbcType=VARCHAR}, #{zhxz,jdbcType=VARCHAR},
      #{zhzh,jdbcType=VARCHAR}, #{khsj,jdbcType=VARCHAR}, #{bgsj,jdbcType=VARCHAR}, #{bgnr,jdbcType=VARCHAR},
      #{zxsj,jdbcType=VARCHAR}, #{rtncode,jdbcType=VARCHAR}, #{rtnmsg,jdbcType=VARCHAR})
  </insert>

    <insert id="insert_hn_ddscxx" parameterType="java.util.Map">
    insert into HN_DDSCXX (NSRSBH, SHXYDM, NSRMC,
      FDDBRXM, SFZJLXDM, SFZJHM,
      LXDH, DKSQID, SQRQ,
      CPDM, LRSJ, CHANNEL_ID
      )
    values (#{nsrsbh,jdbcType=VARCHAR}, #{shxydm,jdbcType=VARCHAR}, #{nsrmc,jdbcType=VARCHAR},
      #{fddbrxm,jdbcType=VARCHAR}, #{sfzjlxDm,jdbcType=VARCHAR}, #{sfzjhm,jdbcType=VARCHAR},
      #{lxdh,jdbcType=VARCHAR}, #{dksqid,jdbcType=VARCHAR}, #{sqrq,jdbcType=VARCHAR},
      #{cpdm,jdbcType=VARCHAR}, sysdate, #{channelId,jdbcType=VARCHAR}
      )
  </insert>



    <!-- 获取反馈表中 最新的 贷款申请Id -->
    <select id="select_feedback_dksqid" parameterType="String"  resultType="java.util.Map">
		SELECT * FROM (select * from  FEEDBACK_HENAN where nsrsbh = #{nsrsbh,jdbcType=VARCHAR} and RTNCODE='000' and (TRANID = 'YSHD.SPJG.GXSPJG' or TRANID = 'YSHD.XXFK.DKXX')  order by createdate desc) WHERE rownum = 1
	</select>

    <select id="query_hn_ddscxx" parameterType="java.util.HashMap"  resultType="java.util.Map">
		select * from (select * from  hn_ddscxx where nsrsbh = #{nsrsbh,jdbcType=VARCHAR} order by lrsj desc)t where rownum = 1
	</select>

    <!-- remark 中存的是dksqid（贷款申请Id） -->
    <select id="select_refetch_dksqid" parameterType="String"  resultType="String">
		select remark from zx_refetch_data where nsrsbh = #{nsrsbh,jdbcType=VARCHAR}
	</select>

    <!-- 查询重取表 -->
    <select id="select_zx_refetch_data" parameterType="String"  resultType="java.util.Map">
		select * from zx_refetch_data where nsrsbh = #{nsrsbh,jdbcType=VARCHAR}
	</select>

    <select id="select_feedback_md5" parameterType="String"  resultType="java.util.Map">
		select 1 from feedback_henan where md5 = #{md5,jdbcType=VARCHAR}
	</select>

    <select id="select_valid_data" parameterType="java.util.Map"  resultType="java.util.Map">
		select 1 from feedback_henan where dksqid = #{dksqid,jdbcType=VARCHAR} AND tranid = #{tranid,jdbcType=VARCHAR} AND rtncode = #{rtncode,jdbcType=VARCHAR}
	</select>

    <insert id="insertZxAnomalyLog" parameterType="java.util.HashMap">
        insert into zx_anomaly_log(
        nsrsbh,
        excep_code,
        excep_msg,
        excep_time)
        values(
        #{nsrsbh,jdbcType=VARCHAR},
        #{excepCode,jdbcType=VARCHAR},
        #{excepMsg,jdbcType=VARCHAR},
        #{excepTime,jdbcType=VARCHAR}
        )
    </insert>

    <!-- 插入 zx_anomaly_timelog_general 表 -->
    <insert id="insertZxAnomalyTimeLog" parameterType="java.util.HashMap">
        insert into zx_anomaly_timelog_general(
        nsrsbh,
        start_time,
        end_time,
        invoke_time,
        flag)
        values(
        #{nsrsbh,jdbcType=VARCHAR},
        #{startTime},
        #{endTime},
        #{invokeTime},
        #{flag,jdbcType=VARCHAR}
        )
    </insert>

    <select id="invokeProcedure" statementType="CALLABLE" parameterType="string">
        {call ${procedureName}(
        #{map.nsrsbh,mode=IN,jdbcType=VARCHAR},
        #{map.out,mode=OUT,jdbcType=INTEGER}
        )}
    </select>


    <insert id="insert_hn_token" parameterType="java.util.HashMap">
		INSERT INTO henan_token (access_token,expries_in) VALUES(#{access_token,jdbcType=VARCHAR},#{expries_in,jdbcType=VARCHAR})
	</insert>

    <select id="query_hn_token"   resultType="java.util.Map">
		select access_token,expries_in from (select access_token,expries_in from  henan_token order by lrsj desc)t where rownum = 1
	</select>

    <insert id="insert_zx_anomaly_log" parameterType="java.util.HashMap">
       insert into zx_anomaly_log(
									nsrsbh,
									excep_code,
									excep_msg,
									excep_time)
									values(
									#{nsrsbh,jdbcType=VARCHAR},
									#{excepCode,jdbcType=VARCHAR},
									#{excepMsg,jdbcType=VARCHAR},
									#{excepTime,jdbcType=VARCHAR}
							       )
    </insert>

    <insert id="insert_zx_anomaly_time_log" parameterType="java.util.HashMap">
       insert into zx_anomaly_timelog_general(
									nsrsbh,
									start_time,
									end_time,
									invoke_time,
									flag)
									values(
									#{nsrsbh,jdbcType=VARCHAR},
									#{startTime},
									#{endTime},
									#{invokeTime},
									#{flag,jdbcType=VARCHAR}
							       )
    </insert>

    <select id="queryDksqidByNsrsbh" resultType="string">
        select dksqid from(
              select dksqid from hn_ddscxx
              where nsrsbh= #{nsrsbh,jdbcType=VARCHAR} or shxydm=#{nsrsbh,jdbcType=VARCHAR}
              order by lrsj desc)
         where rownum = 1
    </select>









    <insert id="insert_hen_dj_ssxx" parameterType="java.util.Map">
    insert into HEN_DJ_SSXX (NSRSBH, NSRMC, ZZJGDM,
      ZZHM, ZCDZ, SCJYDZ,
      ZCDLXDH, HYMXDM, JYFW,
      DJRQ, CYRS, DJZCLXDM,
      ZCZBZE, SYKJZDDM, NSRZTDM,
      NSRZTMC, NSRLXMC, XYDJ,
      XYPFSJ, ZGSWJGMC, SCJYDZXZQHSZDM,
      SCJYDZXZQHMC, SHXYDM, SCJYQXQ,
      SCJYQXZ, FDDBRMC, FRGDDHHM,
      FRYDDHHM, FRDYDZ, FRZJLX,
      FRZJHM, QYSDSSFWHDZS, SNDQYSDS,
      SSNDQYSDS, XSSR, ZCDYZBM,
      SCJYDYZBM, SJSSQQ, SJSSQZ,
      LRSJ)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{nsrmc,jdbcType=VARCHAR}, #{zzjgdm,jdbcType=VARCHAR},
      #{zzhm,jdbcType=VARCHAR}, #{zcdz,jdbcType=VARCHAR}, #{scjydz,jdbcType=VARCHAR},
      #{zcdlxdh,jdbcType=VARCHAR}, #{hymxdm,jdbcType=VARCHAR}, #{jyfw,jdbcType=VARCHAR},
      #{djrq,jdbcType=VARCHAR}, #{cyrs,jdbcType=VARCHAR}, #{djzclxdm,jdbcType=VARCHAR},
      #{zczbze,jdbcType=VARCHAR}, #{sykjzddm,jdbcType=VARCHAR}, #{nsrztdm,jdbcType=VARCHAR},
      #{nsrztmc,jdbcType=VARCHAR}, #{nsrlxmc,jdbcType=VARCHAR}, #{xydj,jdbcType=VARCHAR},
      #{xypfsj,jdbcType=VARCHAR}, #{zgswjgmc,jdbcType=VARCHAR}, #{scjydzxzqhszdm,jdbcType=VARCHAR},
      #{scjydzxzqhmc,jdbcType=VARCHAR}, #{shxydm,jdbcType=VARCHAR}, #{scjyqxq,jdbcType=VARCHAR},
      #{scjyqxz,jdbcType=VARCHAR}, #{fddbrmc,jdbcType=VARCHAR}, #{frgddhhm,jdbcType=VARCHAR},
      #{fryddhhm,jdbcType=VARCHAR}, #{frdydz,jdbcType=VARCHAR}, #{frzjlx,jdbcType=VARCHAR},
      #{frzjhm,jdbcType=VARCHAR}, #{qysdssfwhdzs,jdbcType=VARCHAR}, #{sndqysds,jdbcType=VARCHAR},
      #{ssndqysds,jdbcType=VARCHAR}, #{xssr,jdbcType=VARCHAR}, #{zcdyzbm,jdbcType=VARCHAR},
      #{scjydyzbm,jdbcType=VARCHAR}, #{sjssqq,jdbcType=VARCHAR}, #{sjssqz,jdbcType=VARCHAR},
      sysdate)
    </insert>

	<insert id="insert_hen_dj_bgdjxx" parameterType="java.util.Map" >
    insert into HEN_DJ_BGDJXX (NSRSBH, BGXMDM, BGXMMC,
      BGQNR, LRRQ, XGRQ,
      BGHNR, LRSJ)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{bgxmdm,jdbcType=VARCHAR}, #{bgxmmc,jdbcType=VARCHAR},
      #{bgqnr,jdbcType=VARCHAR}, #{lrrq,jdbcType=VARCHAR}, #{xgrq,jdbcType=VARCHAR},
      #{bghnr,jdbcType=VARCHAR}, sysdate)
  	</insert>

	<insert id="insert_hen_dj_nssbsj" parameterType="java.util.Map">
    insert into HEN_DJ_NSSBSJ (NSRSBH, SBRQ, SBQX,
      ZSXM, SSSQQ, SSSQZ,
      QBXSSR, YSXSSR, YNSE,
      YJSE, LRSJ, YBTSE, JMSE)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{sbrq,jdbcType=VARCHAR}, #{sbqx,jdbcType=VARCHAR},
      #{zsxm,jdbcType=VARCHAR}, #{sssqq,jdbcType=VARCHAR}, #{sssqz,jdbcType=VARCHAR},
      #{qbxssr,jdbcType=VARCHAR}, #{ysxssr,jdbcType=VARCHAR}, #{ynse,jdbcType=VARCHAR},
      #{yjse,jdbcType=VARCHAR}, sysdate, #{ybtse,jdbcType=VARCHAR}, #{jmse,jdbcType=VARCHAR})
  	</insert>

	<insert id="insert_hen_dj_qylrb" parameterType="java.util.Map">
    insert into HEN_DJ_QYLRB (NSRSBH, SBRQ, SSSQQ,
      SSSQZ, XM, HC, BQJE,
      SQJE, LRSJ)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{sbrq,jdbcType=VARCHAR}, #{sssqq,jdbcType=VARCHAR},
      #{sssqz,jdbcType=VARCHAR}, #{xm,jdbcType=VARCHAR}, #{hc,jdbcType=VARCHAR}, #{bqje,jdbcType=VARCHAR},
      #{sqje,jdbcType=VARCHAR}, sysdate)
  	</insert>

	<insert id="insert_hen_dj_qytzfxx" parameterType="java.util.Map">
    insert into HEN_DJ_QYTZFXX (NSRSBH, TZFMC, TZFJJXZMC,
      TZBL, ZJMC, ZJHM, LRSJ
      )
    values (#{nsrsbh,jdbcType=VARCHAR}, #{tzfmc,jdbcType=VARCHAR}, #{tzfjjxzmc,jdbcType=VARCHAR},
      #{tzbl,jdbcType=VARCHAR}, #{zjmc,jdbcType=VARCHAR}, #{zjhm,jdbcType=VARCHAR}, sysdate
      )
  	</insert>

	<insert id="insert_hen_dj_qyzcfzb" parameterType="java.util.Map">
    insert into HEN_DJ_QYZCFZB (NSRSBH, SBRQ, SSSQQ,
      SSSQZ, HC, ZCXM, QMYEZC,
      NCYEZC, QYXM, QMYEQY,
      NCYEQY, LRSJ)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{sbrq,jdbcType=VARCHAR}, #{sssqq,jdbcType=VARCHAR},
      #{sssqz,jdbcType=VARCHAR}, #{hc,jdbcType=VARCHAR}, #{zcxm,jdbcType=VARCHAR}, #{qmyezc,jdbcType=VARCHAR},
      #{ncyezc,jdbcType=VARCHAR}, #{qyxm,jdbcType=VARCHAR}, #{qmyeqy,jdbcType=VARCHAR},
      #{ncyeqy,jdbcType=VARCHAR}, sysdate)
  	</insert>

	<insert id="insert_hen_dj_skzsxx" parameterType="java.util.Map">
    insert into HEN_DJ_SKZSXX (NSRSBH, SSSQQ, SSSQZ,
      JKQX, JKFSRQ, ZSXM,
      SKZL, XSSR, SL, SE,
      LRSJ)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{sssqq,jdbcType=VARCHAR}, #{sssqz,jdbcType=VARCHAR},
      #{jkqx,jdbcType=VARCHAR}, #{jkfsrq,jdbcType=VARCHAR}, #{zsxm,jdbcType=VARCHAR},
      #{skzl,jdbcType=VARCHAR}, #{xssr,jdbcType=VARCHAR}, #{sl,jdbcType=VARCHAR}, #{se,jdbcType=VARCHAR},
      sysdate)
    </insert>

	<insert id="insert_hen_dj_wfwzxx" parameterType="java.util.Map" >
    insert into HEN_DJ_WFWZXX (NSRSBH, DJRQ, WFWZSS,
      WFWZZT, SSSQQ, SSSQZ,
      XGZT, LRSJ, SSWFSDDM, SSWFSDMC)
    values (#{nsrsbh,jdbcType=VARCHAR}, #{djrq,jdbcType=VARCHAR}, #{wfwzss,jdbcType=VARCHAR},
      #{wfwzzt,jdbcType=VARCHAR}, #{sssqq,jdbcType=VARCHAR}, #{sssqz,jdbcType=VARCHAR},
      #{xgzt,jdbcType=VARCHAR}, sysdate, #{sswfsddm,jdbcType=VARCHAR}, #{sswfsddm,jdbcType=VARCHAR})
    </insert>

    <delete id="delete_hen_dj_ssxx" parameterType="java.util.Map">
      delete from HEN_DJ_SSXX where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_bgdjxx" parameterType="java.util.Map">
      delete from HEN_DJ_BGDJXX where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_nssbsj" parameterType="java.util.Map">
      delete from HEN_DJ_NSSBSJ where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_qylrb" parameterType="java.util.Map">
      delete from HEN_DJ_QYLRB where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_qytzfxx" parameterType="java.util.Map">
      delete from HEN_DJ_QYTZFXX where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_qyzcfzb" parameterType="java.util.Map">
      delete from HEN_DJ_QYZCFZB where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_skzsxx" parameterType="java.util.Map">
      delete from HEN_DJ_SKZSXX where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

    <delete id="delete_hen_dj_wfwzxx" parameterType="java.util.Map">
      delete from HEN_DJ_WFWZXX where nsrsbh=#{nsrsbh,jdbcType=VARCHAR}
    </delete>

</mapper>
